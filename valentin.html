<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Petite surprise üíñ</title>

  <style>
    :root{
      --bg:#0b0b12;
      --glass: rgba(255,255,255,.08);
      --border: rgba(255,255,255,.14);
      --txt:#fff;
      --muted: rgba(255,255,255,.75);

      --pink:#ff4fa3;
      --pink2:#ff83c5;

      --yes0:#7CFFB2;
      --yes1:#2fe47b;

      --no0:#ff5a73;
      --no1:#ff2d4f;

      --shadow: 0 24px 90px rgba(0,0,0,.38);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      display:grid;
      place-items:center;
      font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--txt);
      overflow:hidden;
      background:
        radial-gradient(1100px 700px at 50% 18%, #261245 0%, var(--bg) 60%),
        radial-gradient(900px 650px at 80% 85%, #2a0f2a 0%, transparent 70%),
        radial-gradient(900px 650px at 20% 85%, #11244a 0%, transparent 70%),
        linear-gradient(180deg, #0f0b1a, var(--bg));
    }

    /* Hearts floating background */
    .float-hearts{
      position:fixed; inset:0;
      pointer-events:none;
      filter: drop-shadow(0 12px 25px rgba(255,79,163,.14));
      opacity:.9;
      z-index:0;
    }
    .float-hearts span{
      position:absolute;
      left:var(--x);
      bottom:-12vh;
      font-size:var(--s);
      animation: rise var(--t) linear infinite;
      opacity:0;
      transform: translateX(0) rotate(0deg);
    }
    @keyframes rise{
      0%{ transform: translateX(0) translateY(0) rotate(0deg); opacity:0;}
      10%{opacity:.9}
      100%{ transform: translateX(var(--drift)) translateY(-130vh) rotate(360deg); opacity:0;}
    }

    .wrap{
      width:min(920px, 92vw);
      display:grid;
      gap:14px;
      padding:18px;
      justify-items:center;
      z-index:1;
    }

    .card{
      width:100%;
      border-radius:24px;
      background: var(--glass);
      border:1px solid var(--border);
      backdrop-filter: blur(12px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    .top{
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding:16px 18px 10px;
      gap:12px;
      flex-wrap:wrap;
    }
    .title{ font-weight:950; font-size:1.1rem; letter-spacing:.2px; }

    .lives{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight:900;
      color:var(--muted);
      user-select:none;
    }
    .life{
      font-size:1.15rem;
      filter: drop-shadow(0 6px 12px rgba(0,0,0,.25));
      transition: transform 180ms ease, opacity 180ms ease;
    }
    .life.lost{ opacity:.25; transform: scale(.92); }

    .hint{
      padding:0 18px 12px;
      color:var(--muted);
      font-weight:650;
      line-height:1.35;
    }

    /* Game grid */
    .grid{
      padding: 6px 18px 18px;
      display:grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap:12px;
    }

    .tile{
      height:110px;
      border-radius:18px;
      perspective: 900px;
      cursor:pointer;
      user-select:none;
      position:relative;
    }
    .tileInner{
      position:absolute; inset:0;
      border-radius:18px;
      border:1px solid rgba(255,255,255,.16);
      background: rgba(0,0,0,.22);
      box-shadow: 0 16px 50px rgba(0,0,0,.20);
      display:grid;
      place-items:center;
      transform-style:preserve-3d;
      transition: transform 520ms cubic-bezier(.2,.9,.2,1), filter 160ms ease;
      overflow:hidden;
    }
    .tile:hover .tileInner{ filter: brightness(1.06); }

    .faceFront, .faceBack{
      position:absolute; inset:0;
      display:grid;
      place-items:center;
      backface-visibility:hidden;
    }
    .faceFront{
      font-weight:1000;
      letter-spacing:.8px;
      opacity:.85;
      font-size:1.15rem;
    }
    .faceBack{
      transform: rotateY(180deg);
      font-size:2.05rem;
      filter: drop-shadow(0 10px 25px rgba(0,0,0,.35));
    }
    .tile.revealed .tileInner{ transform: rotateY(180deg); }

    .tile.good .tileInner{
      border-color: rgba(255,79,163,.55);
      box-shadow: 0 0 0 4px rgba(255,79,163,.16);
      background: rgba(255,79,163,.10);
    }
    .tile.bad .tileInner{
      border-color: rgba(255,60,90,.45);
      box-shadow: 0 0 0 4px rgba(255,60,90,.14);
      background: rgba(255,60,90,.08);
    }

    /* Click punch */
    .punch{ animation: punch .22s ease; }
    @keyframes punch{
      0%{ transform: translateY(0) scale(1); }
      50%{ transform: translateY(-2px) scale(1.01); }
      100%{ transform: translateY(0) scale(1); }
    }

    .row{
      padding: 0 18px 18px;
      display:flex;
      gap:10px;
      justify-content:center;
      flex-wrap:wrap;
    }
    .btn{
      border:0;
      padding:12px 16px;
      border-radius:14px;
      font-weight:950;
      cursor:pointer;
      background: rgba(255,255,255,.10);
      color: var(--txt);
      border:1px solid rgba(255,255,255,.14);
      transition: transform 120ms ease, filter 120ms ease, background 120ms ease;
      user-select:none;
    }
    .btn:hover{ filter: brightness(1.08); background: rgba(255,255,255,.14); }
    .btn:active{ transform: scale(.98); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; }

    .btn.primary{
      background: linear-gradient(145deg, rgba(255,131,197,.55), rgba(255,79,163,.22));
      border:1px solid rgba(255,79,163,.45);
      box-shadow: 0 14px 40px rgba(255,79,163,.12);
    }

    /* Lose overlay */
    .overlay{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      background: rgba(0,0,0,.40);
      backdrop-filter: blur(8px);
      z-index:20;
    }
    .overlay.show{ display:grid; }
    .modal{
      width:min(520px, 92vw);
      border-radius:22px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      box-shadow: 0 30px 110px rgba(0,0,0,.45);
      padding:18px;
      text-align:center;
      animation: pop .32s ease both;
    }
    @keyframes pop{
      from{ transform: translateY(10px) scale(.98); opacity:0 }
      to{ transform: translateY(0) scale(1); opacity:1 }
    }
    .modal h2{ margin:0 0 6px 0; font-weight:1000; font-size:1.35rem; }
    .modal p{ margin:0 0 14px 0; color:var(--muted); font-weight:650; line-height:1.35; }

    /* Surprise transition */
    .flash{
      position:fixed; inset:0;
      pointer-events:none;
      opacity:0;
      background: radial-gradient(circle at 50% 35%, rgba(255,255,255,.95), rgba(255,255,255,.0) 55%);
      z-index:15;
      transition: opacity 220ms ease;
    }
    .flash.on{ opacity:1; }

    .swapOut{ animation: swapOut .35s ease both; }
    @keyframes swapOut{
      from{ opacity:1; transform: translateY(0) scale(1); }
      to{ opacity:0; transform: translateY(10px) scale(.98); }
    }

    /* Valentine section */
    .valentine{
      display:none;
      width:100%;
      justify-items:center;
      gap:16px;
      padding: 10px 0 0;
    }
    .valentine.show{ display:grid; }

    .valRow{
      width:100%;
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:14px;
      align-items:center;
    }
    @media (max-width: 860px){
      .valRow{ grid-template-columns: 1fr; }
    }

    .valCard{
      border-radius:24px;
      background: rgba(255,255,255,.09);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(12px);
      box-shadow: 0 24px 90px rgba(0,0,0,.28);
      padding:16px;
    }

    /* Photo (simple) */
    .photoWrap{
      display:grid;
      gap:10px;
      justify-items:center;
      text-align:center;
    }
    .photo{
      width:min(320px, 80vw);
      aspect-ratio: 4 / 5;
      border-radius:22px;
      border:1px solid rgba(255,255,255,.18);
      background: rgba(0,0,0,.24);
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,.26);
      position:relative;
    }
    .photo img{
      width:100%; height:100%;
      object-fit:cover;
      display:block;
      transform: scale(1.02);
    }
    .photo::after{
      content:"";
      position:absolute; inset:0;
      background: radial-gradient(circle at 40% 20%, rgba(255,255,255,.18), transparent 55%);
      mix-blend-mode: soft-light;
      pointer-events:none;
    }

    /* Pretty big heart */
    .heartBox{
      display:grid;
      gap:12px;
      justify-items:center;
      text-align:center;
      padding: 6px 0 0;
    }
    .bigHeart{
      position:relative;
      width: 360px;
      height: 320px;
      transform: rotate(-45deg);
      background: linear-gradient(145deg, var(--pink2), var(--pink));
      border-radius: 28px;
      box-shadow:
        0 22px 90px rgba(255,79,163,.26),
        0 0 100px rgba(255,79,163,.10);
      display:grid;
      place-items:center;
      padding: 44px;
      isolation:isolate;
    }
    .bigHeart::before,
    .bigHeart::after{
      content:"";
      position:absolute;
      width:360px; height:320px;
      background: inherit;
      border-radius:50%;
    }
    .bigHeart::before{ top:-160px; left:0; }
    .bigHeart::after{ left:160px; top:0; }

    .heartGlow{
      position:absolute; inset:-24px;
      background: radial-gradient(circle at 30% 25%, rgba(255,255,255,.40), transparent 55%);
      mix-blend-mode: soft-light;
      filter: blur(8px);
      z-index:0;
    }

    .orbit{
      position:absolute; inset:-35px;
      pointer-events:none;
      z-index:2;
    }
    .orb{
      position:absolute;
      left:50%; top:50%;
      transform-origin: -130px 0;
      animation: orbit 6.5s linear infinite;
      filter: drop-shadow(0 10px 20px rgba(0,0,0,.25));
      opacity:.95;
    }
    .orb:nth-child(2){ animation-duration: 8.5s; transform-origin: -160px 0; opacity:.85; }
    .orb:nth-child(3){ animation-duration: 10.5s; transform-origin: -190px 0; opacity:.75; }
    @keyframes orbit{
      from{ transform: rotate(0deg) translateX(0); }
      to{ transform: rotate(360deg) translateX(0); }
    }

    .heartText{
      transform: rotate(45deg);
      width: 88%;
      z-index:1;
      text-shadow: 0 2px 18px rgba(0,0,0,.22);
    }
    .ask{
      font-weight:1000;
      letter-spacing:.2px;
      font-size: 1.55rem;
      line-height:1.18;
      margin:0;
    }
    .ask span{ display:inline-block; font-size:1.75rem; }
    .cuteLine{
      margin-top:10px;
      color: rgba(255,255,255,.92);
      font-weight:750;
      opacity:.95;
    }

    .arena{
      position:relative;
      width:min(560px, 92vw);
      height:170px;
      border-radius:20px;
      background: rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      backdrop-filter: blur(12px);
      overflow:hidden;
      box-shadow: 0 18px 60px rgba(0,0,0,.22);
    }
    .vbtn{
      position:absolute;
      border:0;
      padding:14px 22px;
      border-radius:999px;
      font-weight:1000;
      cursor:pointer;
      user-select:none;
      transition: left 180ms ease, top 180ms ease, transform 160ms ease, filter 160ms ease;
      will-change: left, top, transform;
    }
    .vbtn:active{ transform: scale(.97); }

    .yes{
      background: linear-gradient(145deg, var(--yes0), var(--yes1));
      color:#062014;
      box-shadow: 0 18px 60px rgba(47,228,123,.22);
    }
    .no{
      background: linear-gradient(145deg, var(--no0), var(--no1));
      color:#2a0010;
      box-shadow: 0 18px 60px rgba(255,45,79,.18);
    }

    .underHint{
      color: rgba(255,255,255,.85);
      font-weight:800;
      margin-top:8px;
      text-align:center;
    }

    .finalMsg{
      min-height:38px;
      font-size:1.25rem;
      font-weight:1000;
      text-align:center;
      padding-bottom: 8px;
    }
    .finalMsg.show{ animation: pop2 .38s ease both; }
    @keyframes pop2{
      from{ transform: translateY(8px) scale(.98); opacity:0 }
      to{ transform: translateY(0) scale(1); opacity:1 }
    }

    /* confetti canvas */
    canvas#confetti{
      position:fixed; inset:0;
      pointer-events:none;
      z-index:30;
    }

    /* Final screen with head background */
    .finalScreen{
      position:fixed; inset:0;
      display:none;
      place-items:center;
      z-index:40;
      overflow:hidden;
      animation: finalIn .45s ease both;
    }
    .finalScreen.show{ display:grid; }

    @keyframes finalIn{
      from{ opacity:0; transform: scale(1.02); }
      to{ opacity:1; transform: scale(1); }
    }

    .headBg{
      position:absolute; inset:0;
      background-color:#14081e;
      background-image: url('moi.jpg');
      background-size: 160px 160px;
      background-repeat: repeat;
      filter: blur(2px) saturate(1.15) contrast(1.05);
      opacity:.30;
      transform: scale(1.05);
    }
    .headBg::after{
      content:"";
      position:absolute; inset:0;
      background:
        radial-gradient(900px 600px at 50% 30%, rgba(255,79,163,.30), transparent 60%),
        radial-gradient(900px 600px at 30% 80%, rgba(47,228,123,.18), transparent 60%),
        linear-gradient(180deg, rgba(10,8,18,.55), rgba(10,8,18,.85));
    }
    .finalCard{
    position:relative;
    width:min(760px, 94vw);
    border-radius:28px;
    padding:26px 20px;
    background: rgba(0,0,0,.55);            /* PLUS sombre */
    border: 1px solid rgba(255,255,255,.22);
    backdrop-filter: blur(12px);
    box-shadow: 0 40px 140px rgba(0,0,0,.55);
    text-align:center;
    }

    .finalTitle{
    font-size: clamp(1.9rem, 3.5vw, 3.1rem); /* PLUS grand */
    font-weight: 1000;
    margin: 0 0 10px 0;
    color: #ffffff;                          /* bien blanc */
    letter-spacing: .2px;

    /* Glow + contour pour lisibilit√© */
    text-shadow:
        0 2px 0 rgba(0,0,0,.35),
        0 6px 22px rgba(0,0,0,.55),
        0 0 26px rgba(255,79,163,.35);
    }

    .finalSub{
    margin:0;
    font-weight: 950;
    font-size: clamp(1.05rem, 2.1vw, 1.35rem);
    color: rgba(255,255,255,.92);
    text-shadow: 0 6px 20px rgba(0,0,0,.55);
    }

    .finalHearts{
      margin-top:14px;
      font-size:1.6rem;
      animation: wiggle 1.2s ease-in-out infinite;
      filter: drop-shadow(0 14px 30px rgba(0,0,0,.22));
    }
    @keyframes wiggle{
      0%,100%{ transform: translateY(0) }
      50%{ transform: translateY(-6px) }
    }
  </style>
</head>

<body>
  <div class="float-hearts" id="floatHearts" aria-hidden="true"></div>
  <div class="flash" id="flash"></div>
  <canvas id="confetti"></canvas>

  <!-- Lose overlay -->
  <div class="overlay" id="overlay">
    <div class="modal">
      <h2>Perdu üòÑ</h2>
      <p>Tu as perdu tes 2 vies.</p>
      <button class="btn primary" id="restartOverlay">Recommencer</button>
    </div>
  </div>

  <!-- Final screen -->
  <div class="finalScreen" id="finalScreen">
    <div class="headBg" aria-hidden="true"></div>
    <div class="finalCard">
      <h1 class="finalTitle">Hop maintenant je te garde pour toujours</h1>
      <p class="finalSub"></p>
      <div class="finalHearts">üíó üíû üíò üíï üíñ</div>
    </div>
  </div>

  <div class="wrap">

    <!-- GAME -->
    <div class="card" id="gameCard">
      <div class="top">
        <div class="title">Mini-jeu</div>
        <div class="lives" aria-label="vies">
          <span class="life" id="life1">‚ù§Ô∏è</span>
          <span class="life" id="life2">‚ù§Ô∏è</span>
        </div>
      </div>

      <div class="hint" id="hint">Trouve le c≈ìur üíó. Tu as 2 vies.</div>

      <div class="grid" id="grid"></div>

      <div class="row">
        <button class="btn" id="resetBtn">Recommencer</button>
        <button class="btn primary" id="rewardBtn" disabled>R√©cup√©rer la r√©compense</button>
      </div>
    </div>

    <!-- VALENTINE -->
    <div class="valentine" id="valentine">
      <div class="valRow">

        <!-- Left: Heart + question -->
        <div class="valCard">
          <div class="heartBox">
            <div class="bigHeart">
              <div class="heartGlow"></div>
              <div class="orbit" aria-hidden="true">
                <div class="orb">üíñ</div>
                <div class="orb">‚ú®</div>
                <div class="orb">üíó</div>
              </div>

              <div class="heartText">
                <p class="ask">
                  <span id="nameSpan">Stephanie</span>,<br/>
                  veux-tu √™tre ma valentine ?
                </p>
                <div class="cuteLine">Promis, √ßa vaut le coup üòå</div>
              </div>
            </div>

            <div class="arena" id="arena">
              <button class="vbtn yes" id="yesBtn">Oui üíñ</button>
              <button class="vbtn no" id="noBtn">Non</button>
            </div>

            <div class="underHint">Conseil : Appuis sur Oui (vite vite vite)</div>
            <div class="finalMsg" id="finalMsg"></div>
          </div>
        </div>

        <!-- Right: Photo -->
        <div class="valCard">
          <div class="photoWrap">
            <div class="photo">
              <img alt="Ma photo" src="moi.jpg"
                onerror="this.src='data:image/svg+xml;utf8,<svg xmlns=%22http://www.w3.org/2000/svg%22 width=%22500%22 height=%22650%22><rect width=%22500%22 height=%22650%22 fill=%22%23000000%22 fill-opacity=%220.18%22/><text x=%2250%25%22 y=%2250%25%22 dominant-baseline=%22middle%22 text-anchor=%22middle%22 fill=%22white%22 fill-opacity=%220.75%22 font-family=%22system-ui%22 font-size=%2220%22>moi.jpg</text></svg>';" />
            </div>
          </div>
        </div>

      </div>
    </div>

  </div>

<script>
  // ===== CONFIG =====
  const NAME = "Stephanie"; // change ici
  // ==================

  // Floating hearts bg
  (function makeFloatingHearts(){
    const container = document.getElementById("floatHearts");
    const hearts = ["üíñ","üíó","üíì","üíï","üíò","üíû","‚ú®"];
    const count = 18;
    for(let i=0;i<count;i++){
      const s = document.createElement("span");
      s.textContent = hearts[Math.floor(Math.random()*hearts.length)];
      s.style.setProperty("--x", (Math.random()*100).toFixed(1) + "vw");
      s.style.setProperty("--s", (12 + Math.random()*26).toFixed(0) + "px");
      s.style.setProperty("--t", (9 + Math.random()*10).toFixed(2) + "s");
      s.style.setProperty("--drift", ((Math.random()*2-1)*18).toFixed(1) + "vw");
      s.style.animationDelay = (-Math.random()*12).toFixed(2) + "s";
      container.appendChild(s);
    }
  })();

  // Elements
  const gameCard = document.getElementById("gameCard");
  const grid = document.getElementById("grid");
  const hint = document.getElementById("hint");
  const resetBtn = document.getElementById("resetBtn");
  const rewardBtn = document.getElementById("rewardBtn");
  const overlay = document.getElementById("overlay");
  const restartOverlay = document.getElementById("restartOverlay");
  const life1 = document.getElementById("life1");
  const life2 = document.getElementById("life2");
  const flash = document.getElementById("flash");

  const valentine = document.getElementById("valentine");
  const nameSpan = document.getElementById("nameSpan");
  const arena = document.getElementById("arena");
  const yesBtn = document.getElementById("yesBtn");
  const noBtn = document.getElementById("noBtn");
  const finalMsg = document.getElementById("finalMsg");
  const finalScreen = document.getElementById("finalScreen");

  nameSpan.textContent = NAME;

  // GAME STATE
  let lives = 2;
  let won = false;
  let secretIndex = 0;
  let revealed = new Set();

  function setLivesUI(){
    life1.classList.toggle("lost", lives < 2);
    life2.classList.toggle("lost", lives < 1);
  }
  function randInt(n){ return Math.floor(Math.random()*n); }

  function buildGame(){
    grid.innerHTML = "";
    revealed.clear();
    lives = 2;
    won = false;
    rewardBtn.disabled = true;
    overlay.classList.remove("show");

    setLivesUI();
    hint.textContent = "Trouve le c≈ìur üíó. Tu as 2 vies.";

    secretIndex = randInt(6);

    for(let i=0;i<6;i++){
      const tile = document.createElement("div");
      tile.className = "tile";
      tile.dataset.index = String(i);

      tile.innerHTML = `
        <div class="tileInner">
          <div class="faceFront">?</div>
          <div class="faceBack"></div>
        </div>
      `;

      tile.addEventListener("click", () => {
        if (won) return;
        if (revealed.has(i)) return;
        if (lives <= 0) return;

        revealed.add(i);

        tile.classList.add("punch");
        setTimeout(()=>tile.classList.remove("punch"), 240);

        const back = tile.querySelector(".faceBack");
        const isGood = i === secretIndex;

        tile.classList.add("revealed", isGood ? "good" : "bad");
        back.textContent = isGood ? "üíó" : "üí£";

        if(isGood){
          won = true;
          hint.textContent = "Bien jou√© üôÇ";
          rewardBtn.disabled = false;
        } else {
          lives--;
          setLivesUI();

          if(lives > 0){
            hint.textContent = "Oups‚Ä¶ encore une chance üòÑ";
          } else {
            hint.textContent = "Boom.";
            setTimeout(()=> overlay.classList.add("show"), 260);
          }
        }
      });

      grid.appendChild(tile);
    }
  }

  resetBtn.addEventListener("click", buildGame);
  restartOverlay.addEventListener("click", buildGame);

  // Surprise transition then show Valentine
  function surpriseToValentine(){
    flash.classList.add("on");
    setTimeout(()=>flash.classList.remove("on"), 260);

    gameCard.classList.add("swapOut");
    setTimeout(() => {
      gameCard.style.display = "none";
      valentine.classList.add("show");
      placeValButtons();
      launchConfettiHearts(1200);
    }, 320);
  }

  rewardBtn.addEventListener("click", () => {
    if(!won) return;
    surpriseToValentine();
  });

  // Valentine buttons
  let noTries = 0;

  function clamp(n,min,max){ return Math.max(min, Math.min(max,n)); }

  function placeValButtons(){
    const a = arena.getBoundingClientRect();
    yesBtn.style.left = (a.width*0.34 - yesBtn.offsetWidth/2) + "px";
    yesBtn.style.top  = (a.height*0.52 - yesBtn.offsetHeight/2) + "px";

    noBtn.style.left  = (a.width*0.68 - noBtn.offsetWidth/2) + "px";
    noBtn.style.top   = (a.height*0.52 - noBtn.offsetHeight/2) + "px";
  }

  function growYes(){
    noTries++;
    const scale = 1 + Math.min(noTries * 0.10, 1.25); // max ~2.25
    yesBtn.style.transform = `scale(${scale})`;
  }

  function fleeNoSmooth(){
    const a = arena.getBoundingClientRect();
    const b = noBtn.getBoundingClientRect();
    const pad = 12;

    const maxX = a.width - b.width - pad;
    const maxY = a.height - b.height - pad;

    const x = pad + Math.random()*maxX;
    const y = pad + Math.random()*maxY;

    noBtn.style.left = clamp(x,pad,maxX) + "px";
    noBtn.style.top  = clamp(y,pad,maxY) + "px";

    growYes();
  }

  ["mouseenter","mouseover","pointerenter"].forEach(evt => noBtn.addEventListener(evt, fleeNoSmooth));
  noBtn.addEventListener("click", (e)=>{ e.preventDefault(); fleeNoSmooth(); });
  noBtn.addEventListener("touchstart", (e)=>{ e.preventDefault(); fleeNoSmooth(); }, {passive:false});

  // YES click -> show final screen with head background
  yesBtn.addEventListener("click", () => {
    finalMsg.textContent = "";
    yesBtn.disabled = true;
    noBtn.disabled = true;

    // Small ‚Äúpop‚Äù message first (optional)
    finalMsg.textContent = "Excellent choix‚Ä¶ ‚ú®";
    finalMsg.classList.remove("show");
    void finalMsg.offsetWidth;
    finalMsg.classList.add("show");

    // Confetti + final transition after a short delay
    launchConfettiHearts(1200);
    setTimeout(() => {
      flash.classList.add("on");
      setTimeout(()=>flash.classList.remove("on"), 240);
      finalScreen.classList.add("show");
      launchConfettiHearts(2200);
    }, 520);
  });

  window.addEventListener("resize", () => {
    if(valentine.classList.contains("show")) placeValButtons();
  });

  // Confetti hearts using canvas
  function launchConfettiHearts(durationMs=1600){
    const canvas = document.getElementById("confetti");
    const ctx = canvas.getContext("2d");
    const dpr = Math.max(1, window.devicePixelRatio || 1);

    canvas.width = Math.floor(window.innerWidth * dpr);
    canvas.height = Math.floor(window.innerHeight * dpr);
    ctx.setTransform(dpr,0,0,dpr,0,0);

    const emojis = ["üíñ","üíó","üíï","üíò","üíû","‚ú®","üå∏"];
    const pieces = [];
    const N = 160;

    for(let i=0;i<N;i++){
      pieces.push({
        x: Math.random()*window.innerWidth,
        y: -30 - Math.random()*window.innerHeight*0.25,
        vx: (Math.random()*2-1)*2.2,
        vy: 2 + Math.random()*4.8,
        rot: Math.random()*Math.PI*2,
        vr: (Math.random()*2-1)*0.12,
        size: 10 + Math.random()*18,
        alpha: 0.95,
        emoji: emojis[Math.floor(Math.random()*emojis.length)]
      });
    }

    const start = performance.now();
    function tick(now){
      const t = now - start;
      ctx.clearRect(0,0,window.innerWidth,window.innerHeight);

      pieces.forEach(p=>{
        p.x += p.vx;
        p.y += p.vy;
        p.rot += p.vr;
        p.vx += (Math.random()*2-1)*0.02;
        p.vx = Math.max(-3, Math.min(3, p.vx));

        if(t > durationMs * 0.65) p.alpha -= 0.012;

        ctx.globalAlpha = Math.max(0, p.alpha);
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.font = `${p.size}px system-ui, Apple Color Emoji, Segoe UI Emoji`;
        ctx.fillText(p.emoji, -p.size/2, p.size/2);
        ctx.restore();
      });

      ctx.globalAlpha = 1;
      const alive = (t < durationMs) && pieces.some(p => p.alpha > 0 && p.y < window.innerHeight + 60);
      if(alive) requestAnimationFrame(tick);
      else ctx.clearRect(0,0,window.innerWidth,window.innerHeight);
    }
    requestAnimationFrame(tick);
  }

  // Init
  buildGame();
</script>
</body>
</html>
